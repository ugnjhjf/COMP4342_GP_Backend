<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><!DOCTYPE html>
        <html lang="en">
        <head>
        <meta charset="UTF-8">
        <title>WebSocket JSON Example</title>
</head>
<body>
<h2>WebSocket JSON Communication</h2>
<button onclick="sendMessage()">Send Message</button>
<pre id="output"></pre>

<script>
    let socket = new WebSocket("ws://localhost:8080/ws");

    // 连接建立后触发
    socket.onopen = function () {
        console.log("WebSocket connection established.");
    };

    // 接收到服务器发来的消息时触发
    socket.onmessage = function (event) {
        let receivedData = JSON.parse(event.data);  // 解析 JSON 数据
        console.log("Received message:", receivedData);
        document.getElementById("output").textContent += `Received: ${receivedData.content}\n`;
    };

    // 发送 JSON 消息
    function sendMessage() {
        let message = {
            sender: "client",
            content: "Hello Server!"
        };
        socket.send(JSON.stringify(message));  // 将对象序列化为 JSON 字符串并发送
    }

    // 连接关闭时触发
    socket.onclose = function () {
        console.log("WebSocket connection closed.");
    };

    // 发生错误时触发
    socket.onerror = function (error) {
        console.log("WebSocket error:", error);
    };
</script>
</body>
</html>
</title>
</head>
<body>

</body>
</html>